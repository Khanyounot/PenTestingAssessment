<!-- Created by Adam Godwin -->
<?php
	session_start();

	// Redirect back to index.php if not signed in
	if (!isset($_SESSION['username'])) {
		header('Location: index.php');
	}
?>

<!DOCTYPE html>
<html>
	<head>
		<title>Secure Student App</title>

		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<style>
			@import url('https://fonts.googleapis.com/css?family=Fredoka+One');

			body {
				font-family: 'Fredoka One';
				color: #333;
				display: grid;
				grid-template-areas:
					'header'
					'searches';
			}

			header {
				grid-area: header;
				text-align: center;
				margin-top: 3vh;
			}

			section {
				grid-area: searches;
				align-self: center;
				justify-self: center;
				text-align: center;
				margin: 5vh;
				padding: 5vh;
				width: 40vw;
				height: 60vh;
			}

			#students {
				margin-top: 3vh;
				margin-bottom: 3vh;
				width: 20vw;
				margin-left: 12vw;
			}

			td {
				border: 1px solid grey;
			}

			th,
			td {
				padding: 5px;
			}
			
				
			input["text"] {
				margin-top: 1vh;
				width: 30vw;
			}
		</style>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

		<script type="text/javascript">
			$(document).ready(function () {
				$('#search').select();

				/*
				Listen for the search form to be submitted
				Send the search term to search.php
				Display the results in a table
				*/
				$('#searchForm').submit(function (event) {
					$.ajax({
						type: 'POST',
						url: 'search.php',
						dataType: 'json',
						data: {
							search: $('#search').val(),
						},
						success: function (returnedData) {
							$('#students').html('');

							if (returnedData != '') {
								$('#search').val('');
								$('#search').select();

								$('#students').append("<table>");
								$('#students').append(
									'<tr><th>Name</th><th>Mark</th></tr>'
								);

								$.each(returnedData, function (key, value) {
									$('#students').append(
										'<tr><td>' +
										value.name +
										'</td><td>' +
										value.mark +
										'</td></tr>'
									);
								});

								$('#students').append('</table>');
							} else {
								$('#search').val('');
								$('#search').select();
							}
						},
					});

					event.preventDefault();
				});

				// Listen for the signout button to be clicked
				$('#signout').click(function (event) {
					$(location).attr('href', 'signout.php');
				});
			});
		</script>
	</head>

	<body>
		<header>
			<h1>
				Secure Student App
			</h1>
		</header>
		<section>
			<form id="searchForm">
				<input type="text" id="search" placeholder="Search" autocomplete="off" />
				<input type="submit" id="submit" value="Search" />
				<input type="button" id="signout" value="Signout" />
				
				<div id="students">
				</div>
			</form>
		</section>
	</body>
</html>