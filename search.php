<?php
	// Created by Adam Godwin
	session_start();

	// Do not allow searches if not signed in 
	if (!isset($_SESSION['username'])) {
		header('Location: index.php');
	}
	else {
		$search = $_POST['search'];
		
		$db = new SQLite3('database.sqlite');

		/*
		Search the students table for names that match the search term
		Note, the wildcard % can be used directly in the users search term e.g. a% would match adam, alice etc
		*/
		$sql = "SELECT * FROM students WHERE name LIKE '" . $search . "'";
		$rows = $db->query($sql);

		$json = array();

		// Add each result to an array to be sent back as JSON
		while ($row = $rows->fetchArray()) {
			$json[] = $row;
		}

		$db->close();

		echo json_encode($json);
	}
?>
